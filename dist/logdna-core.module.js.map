{"version":3,"file":"logdna-core.module.js","sourceRoot":"/","sources":["logdna-core.module.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,2CAA+E;AAC/E,yDAAyE;AAMzE,yDAA2D;AAC3D,qDAAiD;AAIjD,IAAa,gBAAgB,wBAA7B,MAAa,gBAAgB;IACpB,MAAM,CAAC,OAAO,CAAC,OAA4B;QAChD,MAAM,QAAQ,GAAG,IAAA,wCAAqB,EAAC,OAAO,CAAC,CAAC;QAEhD,OAAO;YACL,OAAO,EAAE,CAAC,QAAQ,EAAE,8BAAa,CAAC;YAClC,MAAM,EAAE,kBAAgB;YACxB,SAAS,EAAE,CAAC,QAAQ,EAAE,8BAAa,CAAC;SACrC,CAAC;IACJ,CAAC;IAEM,MAAM,CAAC,YAAY,CAAC,OAAiC;QAC1D,MAAM,QAAQ,GAAa;YACzB,MAAM,EAAE,CAAC,wCAAqB,CAAC;YAC/B,OAAO,EAAE,+BAAY;YACrB,UAAU,EAAE,CAAC,OAA4B,EAAE,EAAE,CAAC,IAAI,8BAAa,CAAC,OAAO,CAAC;SACzE,CAAC;QAEF,OAAO;YACL,OAAO,EAAE,CAAC,QAAQ,EAAE,8BAAa,CAAC;YAClC,OAAO,EAAE,OAAO,CAAC,OAAO;YACxB,MAAM,EAAE,kBAAgB;YACxB,SAAS,EAAE;gBACT,GAAG,IAAI,CAAC,oBAAoB,CAAC,OAAO,CAAC;gBACrC,QAAQ;gBACR,8BAAa;aACd;SACF,CAAC;IACJ,CAAC;IAEO,MAAM,CAAC,oBAAoB,CACjC,OAAiC;QAEjC,IAAI,OAAO,CAAC,WAAW,IAAI,OAAO,CAAC,UAAU,EAAE;YAC7C,OAAO,CAAC,IAAI,CAAC,0BAA0B,CAAC,OAAO,CAAC,CAAC,CAAC;SACnD;QACD,MAAM,QAAQ,GAAG,OAAO,CAAC,QAAsC,CAAC;QAChE,OAAO;YACL,IAAI,CAAC,0BAA0B,CAAC,OAAO,CAAC;YACxC;gBACE,OAAO,EAAE,QAAQ;gBACjB,QAAQ;aACT;SACF,CAAC;IACJ,CAAC;IAEO,MAAM,CAAC,0BAA0B,CACvC,OAAiC;QAEjC,IAAI,OAAO,CAAC,UAAU,EAAE;YACtB,OAAO;gBACL,MAAM,EAAE,OAAO,CAAC,MAAM,IAAI,EAAE;gBAC5B,OAAO,EAAE,wCAAqB;gBAC9B,UAAU,EAAE,OAAO,CAAC,UAAU;aAC/B,CAAC;SACH;QACD,MAAM,MAAM,GAAG;YACb,CAAC,OAAO,CAAC,QAAQ,IAAI,OAAO,CAAC,WAAW,CAA+B;SACxE,CAAC;QACF,OAAO;YACL,OAAO,EAAE,wCAAqB;YAC9B,UAAU,EAAE,CAAO,cAAoC,EAAE,EAAE,gDACzD,OAAA,MAAM,cAAc,CAAC,yBAAyB,EAAE,CAAA,GAAA;YAClD,MAAM;SACP,CAAC;IACJ,CAAC;CACF,CAAA;AAlEY,gBAAgB;IAF5B,IAAA,eAAM,GAAE;IACR,IAAA,eAAM,EAAC,EAAE,CAAC;GACE,gBAAgB,CAkE5B;AAlEY,4CAAgB","sourcesContent":["import { Module, Global, Provider, Type, DynamicModule } from '@nestjs/common';\r\nimport { LOGDNA_MODULE_OPTIONS, LOGDNA_TOKEN } from './logdna.constants';\r\nimport {\r\n  LogDNAModuleAsyncOptions,\r\n  LogDNAModuleOptions,\r\n  LogDNAOptionsFactory,\r\n} from './logdna.options';\r\nimport { createLogDNAProviders } from './logdna.providers';\r\nimport { LogDNAService } from './logdna.service';\r\n\r\n@Global()\r\n@Module({})\r\nexport class LogDNACoreModule {\r\n  public static forRoot(options: LogDNAModuleOptions): DynamicModule {\r\n    const provider = createLogDNAProviders(options);\r\n\r\n    return {\r\n      exports: [provider, LogDNAService],\r\n      module: LogDNACoreModule,\r\n      providers: [provider, LogDNAService],\r\n    };\r\n  }\r\n\r\n  public static forRootAsync(options: LogDNAModuleAsyncOptions): DynamicModule {\r\n    const provider: Provider = {\r\n      inject: [LOGDNA_MODULE_OPTIONS],\r\n      provide: LOGDNA_TOKEN,\r\n      useFactory: (options: LogDNAModuleOptions) => new LogDNAService(options),\r\n    };\r\n\r\n    return {\r\n      exports: [provider, LogDNAService],\r\n      imports: options.imports,\r\n      module: LogDNACoreModule,\r\n      providers: [\r\n        ...this.createAsyncProviders(options),\r\n        provider,\r\n        LogDNAService,\r\n      ],\r\n    };\r\n  }\r\n\r\n  private static createAsyncProviders(\r\n    options: LogDNAModuleAsyncOptions\r\n  ): Provider[] {\r\n    if (options.useExisting || options.useFactory) {\r\n      return [this.createAsyncOptionsProvider(options)];\r\n    }\r\n    const useClass = options.useClass as Type<LogDNAOptionsFactory>;\r\n    return [\r\n      this.createAsyncOptionsProvider(options),\r\n      {\r\n        provide: useClass,\r\n        useClass,\r\n      },\r\n    ];\r\n  }\r\n\r\n  private static createAsyncOptionsProvider(\r\n    options: LogDNAModuleAsyncOptions\r\n  ): Provider {\r\n    if (options.useFactory) {\r\n      return {\r\n        inject: options.inject || [],\r\n        provide: LOGDNA_MODULE_OPTIONS,\r\n        useFactory: options.useFactory,\r\n      };\r\n    }\r\n    const inject = [\r\n      (options.useClass || options.useExisting) as Type<LogDNAOptionsFactory>,\r\n    ];\r\n    return {\r\n      provide: LOGDNA_MODULE_OPTIONS,\r\n      useFactory: async (optionsFactory: LogDNAOptionsFactory) =>\r\n        await optionsFactory.createLogDNAModuleOptions(),\r\n      inject,\r\n    };\r\n  }\r\n}\r\n"]}