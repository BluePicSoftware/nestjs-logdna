{"version":3,"file":"logdna.service.js","sourceRoot":"/","sources":["logdna.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { createLogger, Logger } from '@logdna/logger';\r\nimport { Inject, Injectable } from '@nestjs/common';\r\nimport { LoggerService } from '@nestjs/common';\r\nimport { LOGDNA_MODULE_OPTIONS } from './logdna.constants';\r\nimport { LogDNAModuleOptions } from './logdna.options';\r\n\r\n@Injectable()\r\nexport class LogDNAService implements LoggerService {\r\n  private static logDNAinstance: Logger;\r\n  private static serviceInstance: LogDNAService;\r\n\r\n  constructor(\r\n    @Inject(LOGDNA_MODULE_OPTIONS) readonly options?: LogDNAModuleOptions\r\n  ) {\r\n    if (!options) {\r\n      return;\r\n    }\r\n    //inject custom level 'verbose' and 'http'\r\n    if (!options.logDNAOptions) options.logDNAOptions = {};\r\n    if (!options.logDNAOptions.levels) options.logDNAOptions.levels = [];\r\n    options.logDNAOptions.levels.push('info', 'error', 'warn', 'debug', 'verbose', 'http');\r\n    //instantiate logger\r\n    LogDNAService.logDNAinstance = createLogger(\r\n      options.ingestionKey,\r\n      options.logDNAOptions\r\n    );\r\n  }\r\n\r\n  public static LogDNAServiceInstance(): LogDNAService {\r\n    if (!LogDNAService.serviceInstance) {\r\n      LogDNAService.serviceInstance = new LogDNAService();\r\n    }\r\n    return LogDNAService.serviceInstance;\r\n  }\r\n\r\n  log(message: any, ...optionalParams: any[]) {\r\n    try {\r\n      LogDNAService.logDNAinstance.log(JSON.stringify(message), {\r\n        timestamp: Date.now(),\r\n        meta: Object.assign({}, ...optionalParams),\r\n      });\r\n    } catch {}\r\n  }\r\n\r\n  error(message: any, ...optionalParams: any[]) {\r\n    try {\r\n      LogDNAService.logDNAinstance.log(JSON.stringify(message), {\r\n        timestamp: Date.now(),\r\n        meta: Object.assign({}, ...optionalParams),\r\n        level: 'error',\r\n      });\r\n    } catch {}\r\n  }\r\n\r\n  warn(message: any, ...optionalParams: any[]) {\r\n    try {\r\n      LogDNAService.logDNAinstance.log(JSON.stringify(message), {\r\n        timestamp: Date.now(),\r\n        meta: Object.assign({}, ...optionalParams),\r\n        level: 'warn',\r\n      });\r\n    } catch {}\r\n  }\r\n\r\n  debug(message: any, ...optionalParams: any[]) {\r\n    try {\r\n      LogDNAService.logDNAinstance.log(JSON.stringify(message), {\r\n        timestamp: Date.now(),\r\n        meta: Object.assign({}, ...optionalParams),\r\n        level: 'debug',\r\n      });\r\n    } catch {}\r\n  }\r\n\r\n  verbose(message: any, ...optionalParams: any[]) {\r\n    try {\r\n      LogDNAService.logDNAinstance.log(JSON.stringify(message), {\r\n        timestamp: Date.now(),\r\n        meta: Object.assign({}, ...optionalParams),\r\n        level: 'verbose',\r\n      });\r\n    } catch {}\r\n  }\r\n\r\n  http(message: any, req: any, res: any) {\r\n    try {\r\n      LogDNAService.logDNAinstance.log(JSON.stringify(message), {\r\n        timestamp: Date.now(),\r\n        meta: {\r\n          request: req,\r\n          response: res,\r\n        },\r\n        level: 'http',\r\n      });\r\n    } catch {}\r\n  }\r\n}\r\n"]}